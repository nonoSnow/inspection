<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>各流程任务列表</title>
    <link rel="stylesheet" type="text/css" href="../../public/css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../public/css/style.css" />
    <link rel="stylesheet" type="text/css" href="../../public/css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../../public/css/vant.css" />

    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            background-color: #F3F3F3;
        }

        .aui-bar-nav {
            top: 0;
            z-index: 1;
            background: linear-gradient(90deg, rgba(46, 142, 250, 1), rgba(49, 89, 235, 1));
            color: #FFF;
            font-size: 0.95rem;
            font-weight: normal;
            font-stretch: normal;
            letter-spacing: 0rem;
        }

        .aui-bar-nav .aui-btn .aui-iconfont {
            color: #FFF;
            font-weight: 900;
        }

        .aui-bar-nav .aui-pull-right {
            font-size: 0.95rem;
        }

        .flex-con {
            overflow: auto;
            -webkit-overflow-scrolling: touch;
        }

        [v-cloak] {
            display: none;
        }

        .aui-bar-nav .aui-pull-right {
            font-size: 0.95rem;
        }

        #footer {
            width: 100%;
            height: 2.5rem;
            text-align: center;
            position: fixed;
            background-color: #FFF;
            bottom: 0;
            border-top: 1px solid #eee;
        }

        #footer .assign_btn {
            margin: 0.3rem auto;
            padding: 3px 0rem;
            border-radius: 10px;
            background-color: #2970FF !important;
            height: 1.75rem;
            width: 5rem;
            display: block;
        }

        .assignList {
            width: 100%;
            height: auto;
            margin-bottom: 2.5rem;
            background-color: #FFF;
        }

        .list-item {
            width: 90%;
            height: auto;
            margin: auto;
            padding: 0.6rem 0rem;
            box-sizing: border-box;
            overflow: auto;
            border-bottom: 1px solid #F2F2F2;
        }

        .item-check {
            max-width: 8%;
            float: left;
            vertical-align: top;
            margin-right: 2%;
            margin-top: 2px;
        }

        .item-cont {
            width: 100%;
            float: left;
        }

        .item-cont-cont {
            display: inline-block;
            width: 98%;
        }

        .assign {
            float: right;
            color: #FF9320;
        }

        .check-all {
            float: left;
            margin-left: 0.78rem;
            margin-top: 0.65rem;
        }

        .handler-cont {
            font-size: 0.9rem;
            font-weight: 400;
            color: #626262;
            width: 68%;
            display: inline-block;
        }

        .item-item {
            width: 100%;
            margin-bottom: 0.5rem;
            display: flex;
        }

        .item-text {
            width: 2.5rem;
            float: right;
            font-size: 0.7rem;
            color: #2045FF;
            margin-top: 0.15rem;
            text-align: right;
        }

        .item-icon {
            font-size: 0.9rem;
            color: #CCC;
            float: right;
            display: block;
            width: 2.5rem;
            text-align: right;
        }

        .text-left {
            width: 4.5rem;
            font-size: 0.9rem;
            float: left;
        }

        .text-left-title {
            display: inline-block;
            text-align: justify;
            text-align-last: justify;
            width: 90%;
        }

        .text-right {
            width: calc(100% - 7rem);
            margin-left: 0px;
            font-size: 0.9rem;
            color: #A7A7A7;
            padding-left: 0.2rem;
            float: left;
        }

        .border-bom {
            border-bottom: 1px solid #CCC;
        }

        .dialog-item {
            width: 100%;
            height: 2rem;
            line-height: 2rem;
            font-size: 0.9rem;
            display: flex;
        }

        .dialog-input {
            border: 1px solid #CCC !important;
            width: 100% !important;
            height: 1.5rem !important;
            margin-top: 0.25rem !important;
        }

        .showCheack {
          float: left;
          width: 90%;
        }
    </style>
</head>

<body>
    <div id="wrap" class="flex-wrap flex-vertical">
        <header class="aui-bar aui-bar-nav" id="header">
            <div class="aui-pull-left aui-btn" tapmode @click='onBack'>
                <span class="aui-iconfont aui-icon-left"></span>
            </div>
            <div class="aui-title">{{TaskTypeName}}</div>
            <a class="aui-pull-right" style='padding: 0rem 1rem;' @click='isScreen = true'>
                <span>筛选</span>
            </a>
        </header>

        <div class="assignList flex-con">
            <div class="list-item" v-for='(item, index) in list' :key="index">
                <div class='item-check' v-if='taskType == "handle"'>
                    <input class='aui-checkbox' type='checkbox' name='checkbox' @change='onItemCheck()' v-model='item.isChecked'>
                </div>
                <div :class="{showCheack:isShowCheck}">
                  <div class="item-cont" @click='onOpenTaskDetail'>
                      <div class="item-cont-cont">
                          <div class="item-item">
                              <div class="text-left">
                                  <span class="text-left-title">报装编号</span>:
                              </div>
                              <div class="text-right">
                                  {{item.projectNo}}
                              </div>
                          </div>
                          <div class="item-item">
                              <div class="text-left">
                                  <span class="text-left-title">工程类型</span>:
                              </div>
                              <div class="text-right">
                                  {{item.projectType}}
                              </div>
                              <span class="item-text" v-if='taskType == "handle"'>
                                待办理
                              </span>
                              <span class="item-text" v-if='taskType == "detail"'>
                                已办理
                              </span>
                          </div>
                          <div class="item-item">
                              <div class="text-left">
                                  <span class="text-left-title">当前环节</span>:
                              </div>
                              <div class="text-right">
                                  <span>{{item.projectName}}</span>
                              </div>
                              <span class="aui-iconfont aui-icon-right item-icon"></span>
                          </div>
                          <div class="item-item" style="margin-bottom: 0rem;">
                              <div class="text-left">
                                  <span class="text-left-title">接收时间</span>:
                              </div>
                              <div class="text-right">
                                  <span>{{item.projectTime}}</span>
                              </div>
                          </div>
                      </div>
                  </div>
                </div>
            </div>
        </div>

        <footer id="footer" v-if='taskType == "handle"'>
            <div class="check-all" style="">
                <label><input class="aui-checkbox" type="checkbox" name="checkbox" @change='onCheckAll' v-model='isCheckedAll'> 全选</label>
            </div>
            <div class="aui-btn aui-btn-info assign_btn" @click='onTaskAssign'>审批</div>
        </footer>

        <van-dialog v-model="isScreen" :before-close="beforeClose" show-cancel-button>
            <div style="padding: 0.5rem 1.5rem;">
                <div class='border-bom dialog-item' style="display: block;">
                    <span style='float: left;'>筛选条件</span>
                    <span style='float: right;' @click='onReset'>重置<span class="aui-iconfont aui-icon-refresh" style="font-size: 0.9rem; margin-left: 0.2rem;"></span></span>
                </div>
                <div class='dialog-item'>
                    <div class="text-left">
                        <span class="text-left-title">工程名称</span>:
                    </div>
                    <div class='text-right' style="width: calc(100% - 4.8rem); margin-left: 0.2rem;">
                        <input type="text" class='dialog-input' v-model='searchName'>
                    </div>
                </div>
                <div class='dialog-item'>
                    <div class="text-left">
                        <span class="text-left-title">建设单位</span>:
                    </div>
                    <div class='text-right' style="width: calc(100% - 4.8rem); margin-left: 0.2rem;">
                        <input type="text" class='dialog-input' v-model='searchCompany'>
                    </div>
                </div>
                <div class='dialog-item'>
                    <div class="text-left">
                        <span class="text-left-title">联系电话</span>:
                    </div>
                    <div class='text-right' style="width: calc(100% - 4.8rem); margin-left: 0.2rem;">
                        <input type="text" class='dialog-input' v-model='searchContact'>
                    </div>
                </div>
                <div class='dialog-item'>
                    <div class="text-left">
                        <span class="text-left-title">工程编号</span>:
                    </div>
                    <div class='text-right' style="width: calc(100% - 4.8rem); margin-left: 0.2rem;">
                        <input type="text" class='dialog-input' v-model='searchNo'>
                    </div>
                </div>
                <div class='dialog-item'>
                    <div class="text-left">
                        <span class="text-left-title">报装编号</span>:
                    </div>
                    <div class='text-right' style="width: calc(100% - 4.8rem); margin-left: 0.2rem;">
                        <input type="text" class='dialog-input' v-model='searchProjectNo'>
                    </div>
                </div>
            </div>

        </van-dialog>
    </div>
</body>
<script type="text/javascript" src="../../public/script/api.js"></script>
<script type="text/javascript" src="../../public/script/common.js"></script>
<script type="text/javascript" src="../../public/script/remote.js"></script>
<script type="text/javascript" src="../../public/script/publicMethod.js"></script>
<script type="text/javascript" src="../../public/script/vue/fastclick.min.js"></script>
<script type="text/javascript" src="../../public/script/vue/vue.min.js"></script>
<script type="text/javascript" src="../../public/script/vue/vant.min.js"></script>
<script type="text/javascript" src="../../public/script/vue/vueTouch.js"></script>
<script type="text/javascript" src="../../public/script/moment.js"></script>
<script type="text/javascript" src="../../public/script/diy/public.js"></script>
<script type="text/javascript">
    apiready = function() {
        var header = $api.byId('header');
        $api.fixStatusBar(header);


        fnIntVue();
        Origami.fastclick(document.body) //消除vue的ios端点击延迟
    };

    function fnIntVue() {
        window.TaskVue = new Vue({
            el: '#wrap',
            data: {
                taskType: api.pageParam.type,
                isShowCheck: api.pageParam.type == "handle" ? true : false,
                TaskTypeName: '决算审核',
                isScreen: false,
                list: [{
                    projectNo: '20200910000001',
                    projectType: '非居民用水用户工程',
                    projectName: '预算审核',
                    projectTime: '2020-09-10 9:00',
                    isChecked: false
                }, {
                    projectNo: '20200910000002',
                    projectType: '零星工程',
                    projectName: '预算审核',
                    projectTime: '2020-09-10 9:00',
                    isChecked: false
                }, {
                    projectNo: '20200910000003',
                    projectType: '居民用水用户工程',
                    projectName: '预算审核',
                    projectTime: '2020-09-10 9:00',
                    isChecked: false
                }, {
                    projectNo: '20200910000004',
                    projectType: '零星工程',
                    projectName: '预算审核',
                    projectTime: '2020-09-10 9:00',
                    isChecked: false
                }, ],
                isCheckedAll: false,
                searchName: '',
                searchCompany: '',
                searchContact: '',
                searchNo: '',
                searchProjectNo: ''
            },
            methods: {
                onBack() {
                    api.closeWin({});
                },
                onItemCheck() {
                    //列表复选框点击
                    var isAllCheck = true;
                    for (var i = 0; i < this.list.length; i++) {
                        if (this.list[i].isChecked == false) {
                            isAllCheck = false;
                        }
                        if (i == this.list.length - 1) {
                            if (isAllCheck) {
                                this.isCheckedAll = true;
                            } else {
                                this.isCheckedAll = false;
                            }
                        }
                    }
                },
                onCheckAll() {
                    for (var i = 0; i < this.list.length; i++) {
                        this.list[i].isChecked = this.isCheckedAll;
                    }
                },
                onOpenTaskDetail() {
                  var _that = this;
                  console.log(_that.taskType);
                  api.openWin({
                      name: 'TaskHandleDetail',
                      url: './TaskHandleDetail.html',
                      pageParam: {
                          type: _that.taskType
                      }
                  });

                },
                onTaskAssign() {

                },
                beforeClose(action, done) {
                    var _that = this;
                    if (action === 'confirm') {
                        done(); //提交成功
                    } else if (action === 'cancel') {
                        done(); //关闭
                    }
                },
                onReset() {
                    this.searchName = '';
                    this.searchCompany = '';
                    this.searchContact = '';
                    this.searchNo = '';
                    this.searchProjectNo = '';
                }
            },
            mounted: function() {
              console.log(this.taskType)
            }
        });
    }
</script>

</html>
